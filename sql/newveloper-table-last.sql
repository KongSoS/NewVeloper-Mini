/* 수정사항 
 * 1. 내 장소 (매장명, 매장주소), 매장연락처 UNIQUE 제약 조건 삭제
 * 2. USER_NO을 참조하고 있는 제약 조건에 삭제 조건(ON DELETE CASCADE) 추가 
 * */

/* 시퀀스 삭제 */
DROP SEQUENCE SEQ_MY_NO;
DROP SEQUENCE SEQ_PL_NO;
DROP SEQUENCE SEQ_USER_NO;
DROP SEQUENCE SEQ_RESERVE_NO;

/* 테이블 삭제 */
DROP TABLE RESERVATION;
DROP TABLE PLACE_LIST;
DROP TABLE MY_LIST;
DROP TABLE TAG;
DROP TABLE CATEGORY;
DROP TABLE PL_USER;





/* 카테고리 테이블 생성 */
CREATE TABLE CATEGORY (
	CATEGORY_CODE VARCHAR2(10),
	CATEGORY_NAME VARCHAR2(20)
);

/* 컬럼 별칭 설정 */
COMMENT ON COLUMN CATEGORY.CATEGORY_CODE IS '카테고리코드';
COMMENT ON COLUMN CATEGORY.CATEGORY_NAME IS '카테고리명';

/* 컬럼 제약조건 및 제약조건명 설정 */
ALTER TABLE CATEGORY 
ADD CONSTRAINT PK_CG_CODE PRIMARY KEY (CATEGORY_CODE);

ALTER TABLE CATEGORY 
MODIFY CATEGORY_NAME CONSTRAINT NN_CG_NAME NOT NULL;

/* 데이터 삽입 */
INSERT INTO CATEGORY VALUES('C1','한식');
INSERT INTO CATEGORY VALUES('C2','중식');
INSERT INTO CATEGORY VALUES('C3','일식');
INSERT INTO CATEGORY VALUES('C4','양식');
INSERT INTO CATEGORY VALUES('C5','분식');
INSERT INTO CATEGORY VALUES('C6','카페 디저트');





/* 태그 테이블 생성 */
CREATE TABLE TAG (
	TAG_CODE VARCHAR2(10),
	TAG_NAME VARCHAR2(30)
);

/* 컬럼 별칭 설정 */
COMMENT ON COLUMN TAG.TAG_CODE IS '태그코드';
COMMENT ON COLUMN TAG.TAG_NAME IS '태그명';

/* 컬럼 제약조건 및 제약조건명 설정 */
ALTER TABLE TAG 
ADD CONSTRAINT PK_TAG_CODE PRIMARY KEY (TAG_CODE);

ALTER TABLE TAG 
MODIFY TAG_NAME CONSTRAINT NN_TAG_NAME NOT NULL;

/* 데이터 삽입 */
INSERT INTO TAG VALUES('T1','맛있는');
INSERT INTO TAG VALUES('T2','분위기 좋은');
INSERT INTO TAG VALUES('T3','친절한');
INSERT INTO TAG VALUES('T4','깨끗한');
INSERT INTO TAG VALUES('T5','양이 많은');




/* 플레이스리스트(장소추천) 테이블 생성  */
CREATE TABLE PLACE_LIST (
	PL_NO NUMBER,
	PL_NAME VARCHAR2(50),
	PL_ADDRESS VARCHAR2(100),
	PL_TEL VARCHAR2(20),
	SCORE NUMBER,
	PL_CATECODE VARCHAR2(10),
	PL_TAGCODE VARCHAR2(10),
	PL_RESERVE VARCHAR2(3)
);

/* 컬럼 별칭 설정 */
COMMENT ON COLUMN PLACE_LIST.PL_NO IS '장소번호';
COMMENT ON COLUMN PLACE_LIST.PL_NAME IS '매장명';
COMMENT ON COLUMN PLACE_LIST.PL_ADDRESS IS '매장주소';
COMMENT ON COLUMN PLACE_LIST.PL_TEL IS '매장연락처';
COMMENT ON COLUMN PLACE_LIST.SCORE IS '별점';
COMMENT ON COLUMN PLACE_LIST.PL_CATECODE IS '카테고리코드';
COMMENT ON COLUMN PLACE_LIST.PL_TAGCODE IS '태그코드';
COMMENT ON COLUMN PLACE_LIST.PL_RESERVE IS '예약가능여부';

/* 컬럼 제약조건 및 제약조건명 설정 */
ALTER TABLE PLACE_LIST 
ADD CONSTRAINT PK_PL_NO PRIMARY KEY (PL_NO);

ALTER TABLE PLACE_LIST
ADD CONSTRAINT FK_PL_CATE FOREIGN KEY (PL_CATECODE) REFERENCES CATEGORY(CATEGORY_CODE) ON DELETE SET NULL;

ALTER TABLE PLACE_LIST
ADD CONSTRAINT FK_PL_TAG FOREIGN KEY (PL_TAGCODE) REFERENCES TAG(TAG_CODE) ON DELETE SET NULL;

ALTER TABLE PLACE_LIST 
ADD CONSTRAINT UN_NAME_ADD UNIQUE (PL_NAME, PL_ADDRESS);

ALTER TABLE PLACE_LIST 
ADD CONSTRAINT UN_PL_TEL UNIQUE (PL_TEL);

ALTER TABLE PLACE_LIST 
MODIFY PL_NAME CONSTRAINT NN_PL_NAME NOT NULL;

ALTER TABLE PLACE_LIST 
MODIFY PL_ADDRESS CONSTRAINT NN_PL_ADDRESS NOT NULL;

ALTER TABLE PLACE_LIST 
MODIFY PL_CATECODE CONSTRAINT NN_PL_CATECODE NOT NULL;

ALTER TABLE PLACE_LIST 
MODIFY PL_TAGCODE CONSTRAINT NN_PL_TAGCODE NOT NULL;

ALTER TABLE PLACE_LIST 
MODIFY PL_RESERVE CONSTRAINT NN_PL_RESERVE NOT NULL;

ALTER TABLE PLACE_LIST
ADD CONSTRAINT CH_PL_RESERVE CHECK (PL_RESERVE IN ('Y', 'N'));

/* PL_NO을 위한 시퀀스 생성 */
CREATE SEQUENCE SEQ_PL_NO
  START WITH 1
  INCREMENT BY 1
  NOCYCLE
  NOCACHE;

/* 데이터 삽입 */
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'초밥아저씨', '관악구 신원로 23', '0232812820', 4 , 'C3', 'T5', 'Y');
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'까사미아푸드', '금천구 가산동 429-1', '028679199', 4 , 'C1', 'T5', 'N');
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'장군집', '영등포구 선유선로 97, 1층 1호', '0236671392', 5 , 'C1', 'T1', 'N');
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'하이준카페', '마포구 동교로 105', '0231443946', 4 , 'C6', 'T2', 'N');
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'피터팬1978', '서대문구 증가로 10', '023364775', 5 , 'C6', 'T3', 'N');
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'브로스', '종로구 종로10길 13', '027332708', 3 , 'C4', 'T3', 'Y');
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'샤오바오우육면', '종로구 삼일대로17길 15', '027237788', 4 , 'C2', 'T4', 'Y');
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'서하네김밥', '용산구 한강대로 139-1', '027922355', 5 , 'C5', 'T5', 'N');
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'이디야커피', '금천구 가산동 426-5 월드메르디앙2차 101호', '0220258389', 4 , 'C6', 'T2', 'N');
INSERT INTO PLACE_LIST VALUES (SEQ_PL_NO.NEXTVAL,'직화삼곱', '성동구 아차산로 97 1층', '0213850274', 5 , 'C1', 'T1', 'Y');


 
  

/* 회원정보 테이블 생성 */
CREATE TABLE PL_USER (
	USER_NO NUMBER,
	USER_ID VARCHAR2(20),
	USER_PWD VARCHAR2(40),
	USER_NAME VARCHAR2(20),
	PHONE VARCHAR2(20),
	ENROLL_DATE DATE DEFAULT SYSDATE,
	DEL_DATE DATE,
	STATUS VARCHAR2(1) DEFAULT 'N',
	MANAGER VARCHAR2(1)	DEFAULT 'N'
);

/* 컬럼 별칭 설정 */
COMMENT ON COLUMN PL_USER.USER_NO IS '회원번호';
COMMENT ON COLUMN PL_USER.USER_ID IS '아이디';
COMMENT ON COLUMN PL_USER.USER_PWD IS '비밀번호';
COMMENT ON COLUMN PL_USER.USER_NAME IS '이름';
COMMENT ON COLUMN PL_USER.PHONE IS '휴대전화';
COMMENT ON COLUMN PL_USER.ENROLL_DATE IS '가입일';
COMMENT ON COLUMN PL_USER.DEL_DATE IS '탈퇴일';
COMMENT ON COLUMN PL_USER.STATUS IS '탈퇴여부';
COMMENT ON COLUMN PL_USER.MANAGER IS '관리자여부';

/* 컬럼 제약조건 및 제약조건명 설정 */
ALTER TABLE PL_USER 
ADD CONSTRAINT PK_USER_NO PRIMARY KEY (USER_NO);

ALTER TABLE PL_USER 
MODIFY USER_ID CONSTRAINT NN_USER_ID NOT NULL;

ALTER TABLE PL_USER 
MODIFY USER_PWD CONSTRAINT NN_USER_PWD NOT NULL;

ALTER TABLE PL_USER 
MODIFY USER_NAME CONSTRAINT NN_USER_NAME NOT NULL;

ALTER TABLE PL_USER 
MODIFY PHONE CONSTRAINT NN_PHONE NOT NULL;

ALTER TABLE PL_USER 
MODIFY ENROLL_DATE CONSTRAINT NN_ENROLL_DATE NOT NULL;

ALTER TABLE PL_USER 
MODIFY STATUS CONSTRAINT NN_STATUS NOT NULL;

ALTER TABLE PL_USER 
MODIFY MANAGER CONSTRAINT NN_MANAGER NOT NULL;

ALTER TABLE PL_USER
ADD CONSTRAINT CH_STATUS CHECK (STATUS IN ('Y', 'N'));

ALTER TABLE PL_USER
ADD CONSTRAINT CH_MANAGER CHECK (MANAGER IN ('Y', 'N'));

/* USER_NO을 위한 시퀀스 생성 */
CREATE SEQUENCE SEQ_USER_NO
  START WITH 1
  INCREMENT BY 1
  NOCYCLE
  NOCACHE;

/* 데이터 삽입 (매니저 계정) */
INSERT INTO PL_USER
VALUES (SEQ_USER_NO.NEXTVAL, 'manager', 'manager', '매니저', '01012345678', SYSDATE , NULL , 'N' ,'Y');





/* 마이리스트(내 장소) 테이블 생성 */
CREATE TABLE MY_LIST (
	MY_NO NUMBER,
	USER_NO NUMBER,
	MY_NAME VARCHAR2(50),
	MY_ADDRESS VARCHAR2(100),
	MY_TEL VARCHAR2(20),
	MY_SCORE NUMBER,
	MY_CATECODE VARCHAR2(10),
	MY_TAGCODE VARCHAR2(10),
	MY_RESERVE VARCHAR2(3)
);


/* 컬럼 별칭 설정 */
COMMENT ON COLUMN MY_LIST.MY_NO IS '내장소번호';
COMMENT ON COLUMN MY_LIST.USER_NO IS '회원번호';
COMMENT ON COLUMN MY_LIST.MY_NAME IS '매장명';
COMMENT ON COLUMN MY_LIST.MY_ADDRESS IS '매장주소';
COMMENT ON COLUMN MY_LIST.MY_TEL IS '매장연락처';
COMMENT ON COLUMN MY_LIST.MY_SCORE IS '별점';
COMMENT ON COLUMN MY_LIST.MY_CATECODE IS '카테고리코드';
COMMENT ON COLUMN MY_LIST.MY_TAGCODE IS '태그코드';
COMMENT ON COLUMN MY_LIST.MY_RESERVE IS '예약가능여부';

/* 컬럼 제약조건 및 제약조건명 설정 */
ALTER TABLE MY_LIST 
ADD CONSTRAINT PK_MY_NO PRIMARY KEY (MY_NO);

ALTER TABLE MY_LIST
ADD CONSTRAINT FK_MY_CATE FOREIGN KEY (MY_CATECODE) REFERENCES CATEGORY(CATEGORY_CODE) ON DELETE SET NULL;

ALTER TABLE MY_LIST
ADD CONSTRAINT FK_MY_TAG FOREIGN KEY (MY_TAGCODE) REFERENCES TAG(TAG_CODE) ON DELETE SET NULL;

ALTER TABLE MY_LIST
ADD CONSTRAINT FK_MY_USER_NO FOREIGN KEY (USER_NO) REFERENCES PL_USER(USER_NO) ON DELETE CASCADE;

ALTER TABLE MY_LIST 
MODIFY MY_NAME CONSTRAINT NN_MY_NAME NOT NULL;

ALTER TABLE MY_LIST 
MODIFY MY_ADDRESS CONSTRAINT NN_MY_ADDRESS NOT NULL;

ALTER TABLE MY_LIST 
MODIFY MY_CATECODE CONSTRAINT NN_MY_CATECODE NOT NULL;

ALTER TABLE MY_LIST 
MODIFY MY_TAGCODE CONSTRAINT NN_MY_TAGCODE NOT NULL;

ALTER TABLE MY_LIST 
MODIFY MY_RESERVE CONSTRAINT NN_MY_RESERVE NOT NULL;

ALTER TABLE MY_LIST
ADD CONSTRAINT CH_MY_RESERVE CHECK (MY_RESERVE IN ('Y', 'N'));

/* MY_NO을 위한 시퀀스 생성 */
CREATE SEQUENCE SEQ_MY_NO
  START WITH 1
  INCREMENT BY 1
  NOCYCLE
  NOCACHE;





/* 예약 테이블 생성 */
CREATE TABLE RESERVATION (
	RESERVE_NO	NUMBER,
	USER_NO	NUMBER,
	MY_NO	NUMBER,
	RESERVE_DAY	DATE,
	RESERVE_TIME	VARCHAR2(20)
);

/* 컬럼 별칭 설정 */
COMMENT ON COLUMN RESERVATION.RESERVE_NO IS '예약번호';
COMMENT ON COLUMN RESERVATION.USER_NO IS '회원번호';
COMMENT ON COLUMN RESERVATION.MY_NO IS '내장소번호';
COMMENT ON COLUMN RESERVATION.RESERVE_DAY IS '예약날짜';
COMMENT ON COLUMN RESERVATION.RESERVE_TIME IS '예약시간';

/* 컬럼 제약조건 및 제약조건명 설정 */
ALTER TABLE RESERVATION 
ADD CONSTRAINT PK_RESERVE_NO PRIMARY KEY (RESERVE_NO);

ALTER TABLE RESERVATION 
ADD CONSTRAINT FK_USER_NO FOREIGN KEY(USER_NO) REFERENCES PL_USER(USER_NO) ON DELETE CASCADE;

ALTER TABLE RESERVATION 
ADD CONSTRAINT FK_MY_NO FOREIGN KEY (MY_NO) REFERENCES MY_LIST(MY_NO);

ALTER TABLE RESERVATION 
MODIFY RESERVE_NO CONSTRAINT NN_RESERVE_NO NOT NULL;

ALTER TABLE RESERVATION 
MODIFY USER_NO CONSTRAINT NN_USER_NO NOT NULL;

ALTER TABLE RESERVATION 
MODIFY MY_NO CONSTRAINT NN_MY_NO NOT NULL;

ALTER TABLE RESERVATION 
MODIFY RESERVE_DAY CONSTRAINT NN_RESERVE_DAY NOT NULL;

/* RESERVE_NO을 위한 시퀀스 생성 */
CREATE SEQUENCE SEQ_RESERVE_NO
  START WITH 1
  INCREMENT BY 1
  NOCYCLE
  NOCACHE;