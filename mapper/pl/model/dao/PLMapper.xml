<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pl.model.dao.PLDAO">


<resultMap type="pl.model.dto.PLListAndCategoryDTO" id="plListAllResultMap">
	<id property="pl_no" column="PL_NO"/>
	<result property="rownum" column="ROWNUM"/>
	<result property="pl_name" column="PL_NAME"/>
	<result property="pl_address" column="PL_ADDRESS"/>
	<result property="pl_tel" column="PL_TEL"/>
	<result property="score" column="SCORE"/>
	<result property="pl_reserve" column="PL_RESERVE"/>
	<association property="category" resultMap="categoryResultMap"/>
</resultMap>
<resultMap type="pl.model.dto.PLCategoryDTO" id="categoryResultMap">
	<id property="category_code" column="CATEGORY_CODE"/>
	<result property="category_name" column="CATEGORY_NAME"/>
</resultMap>

	<select id="selectAllName" resultMap="plListAllResultMap">
		SELECT
			A.*,
			B.*
		FROM PLACE_LIST A
		JOIN CATEGORY B ON A.PL_CATECODE = B.CATEGORY_CODE 
	</select>


	<select id="selectAllAddress" resultMap="plListAllResultMap">
		SELECT 
			ROWNUM,
			A.*
		FROM (
			 SELECT *
			 FROM PLACE_LIST
			 ORDER BY PL_ADDRESS 
		) A
	</select>
	
	
	<select id="selectAllScore" resultMap="plListAllResultMap">
		SELECT  
			ROWNUM,
			SS.*
		FROM (
				SELECT *
				FROM PLACE_LIST A
				ORDER BY A.SCORE DESC
			) SS
	</select>
	
	<select id="selectAllCategory" resultMap="plListAllResultMap">
		SELECT  
			ROWNUM,
			CS.*
		FROM (
				SELECT 
					A.*,
					B.*
				FROM PLACE_LIST A
				JOIN CATEGORY B ON A.PL_CATECODE = B.CATEGORY_CODE 
				ORDER BY A.PL_CATECODE
			)CS
	</select>
	
	<select id="selectOnlyCategory" resultMap="categoryResultMap">
		SELECT 
			B.CATEGORY_CODE ,
			B.CATEGORY_NAME
		FROM PLACE_LIST A
		JOIN CATEGORY B ON A.PL_CATECODE = B.CATEGORY_CODE 
		ORDER BY A.PL_CATECODE
	</select>
	


<resultMap type="pl.model.dto.PLListAndCategoryDTO" id="myListAllResultMap">
	<id property="pl_no" column="MY_NO"/>
	<result property="rownum" column="ROWNUM"/>
	<result property="pl_name" column="MY_NAME"/>
	<result property="pl_address" column="MY_ADDRESS"/>
	<result property="pl_tel" column="MY_TEL"/>
	<result property="score" column="MY_SCORE"/>
	<result property="pl_reserve" column="MY_RESERVE"/>
	<association property="category" resultMap="myCategoryResultMap"/>
</resultMap>
<resultMap type="pl.model.dto.PLCategoryDTO" id="myCategoryResultMap">
	<id property="category_code" column="CATEGORY_CODE"/>
	<result property="category_name" column="CATEGORY_NAME"/>
</resultMap>

	<select id="selectAllPlace" resultMap="myListAllResultMap">
		SELECT * FROM MY_LIST
	</select>
	
<resultMap type = "pl.model.dto.PLRservationDTO" id = "reserveResultMap">
		<id property = "reserve_no" column = "RESERVE_NO"/>
		<result property = "user_no" column ="USER_NO"/>
		<result property = "my_no" column ="MY_NO"/>
		<result property = "reserve_day" column ="RESERVE_DAY"/>
		<result property = "reserve_time" column ="RESERVE_TIME"/>
	</resultMap>

	<select id = "reserveMine" resultMap = "reserveResultMap">
		SELECT
				A. RESERVE_NO AS 예약번호
				, B. MY_NAME AS 매장명
			FROM RESERVATION A
			JOIN MY_LIST B
			ON A.MY_NO = B.MY_NO
--JOIN USER C
--ON B.USER_NO = C.USER_NO
--WHERE B.USER_NO = ?
--;
	</select>

	<select id = "reserveInfo" parameterType="_int" resultMap = "reserveResultMap">
		SELECT
				A. MY_NAME
				, B. RESERVE_DAY <!-- 여기서 TO_DATE을 쓸지-->
				, B. RESERVE_TIME
			FROM MY_LIST A
			JOIN RESERVATION B
			ON A.MY_NO = B.MY_NO
--JOIN USER C
--ON B.USER_NO = C.USER_NO
--WHERE B.USER_NO = ?
--;
			WHERE B.RESERVE_NO = #{ reserve_no }
	</select>
	
	<insert id="addReserve" parameterType="pl.model.dto.PLRservationDTO">
        INSERT
          INTO RESERVATION
        (
         RESERVE_DAY
        , RESERVE_TIME
        )
        VALUES
        (
          SEQ_MENU_CODE.NEXTVAL
        , #{ reserve_day }
        , #{ reserve_time }
        )
	</insert>

	<update id="editReserve" parameterType="pl.model.dto.PLRservationDTO">
        UPDATE RESERVATION
        SET
      
       RESERVE_DAY =#{ reserve_day }
        , RESERVE_TIME=#{ reserve_time }
        
        WHERE RESERVE_NO = #{ reserve_no }
       
        
	</update>
	
	<delete id="cancelReserve" parameterType="_int">
        DELETE
          FROM RESERVATION
       	 WHERE RESERVE_NO = #{ reserve_no }
        
	</delete>
	
	
	
	
	
	
	
	<resultMap type="pl.model.dto.PLUserDTO" id="userMap">
	<id property="user_no" column="USER_NO"/>
	<result property="user_id" column="USER_ID"/>
	<result property="user_pwd" column="USER_PWD"/>
	<result property="user_name" column="USER_NAME"/>
	<result property="phone" column="PHONE"/>
	<result property="enroll_date" column="ENROLL_DATE"/>
	<result property="del_date" column="DEL_DATE"/>
	<result property="status" column="STATUS"/>
	<result property="manager" column="MANAGER"/>
	</resultMap>
	
	<select id="userIdOverlapCheck" parameterType="string" resultMap="userMap">
		SELECT *
		  FROM PL_USER
		 WHERE USER_ID = #{user_id}
	</select>
	
	<select id="userPwdOverlapCheck" parameterType="string" resultMap="userMap">
		SELECT *
		  FROM PL_USER
		 WHERE USER_PWD = #{user_pwd}
	</select>
	
	<insert id="registUser" parameterType="pl.model.dto.PLUserDTO">
        INSERT
          INTO PL_USER A
        (
          A.USER_NO
        , A.USER_ID
        , A.USER_PWD
        , A.USER_NAME
        , A.PHONE
        )
        VALUES
        (
          SEQ_USER_NO.NEXTVAL
        , #{ user_id }
        , #{ user_pwd }
        , #{ user_name }
        , #{ phone }
        )
	</insert>
	
	
	<select id = "selectUserList" parameterType="common.SearchUserStandard" resultMap="userMap">
		SELECT
		       *
		  FROM PL_USER
		
		<if test ="condition == 'user_name'">
			WHERE USER_NAME = #{value}
		</if>
		
		<if test ="condition == 'user_id'">
			WHERE USER_ID = #{value}
		</if>
	</select>

</mapper>